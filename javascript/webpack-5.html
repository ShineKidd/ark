<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | 🚀</title>
    <meta name="description" content="blog">
    <link rel="stylesheet" href="/assets/style.a9a602e8.css">
    <link rel="modulepreload" href="/assets/Home.52b661e2.js">
    <link rel="modulepreload" href="/assets/AlgoliaSearchBox.a4b89da4.js">
    <link rel="modulepreload" href="/assets/app.8a965c85.js">
    <link rel="modulepreload" href="/assets/javascript_webpack-5.md.63d49dba.lean.js">
    <link rel="modulepreload" href="/assets/app.8a965c85.js">
    <meta name="twitter:title" content="webpack | 🚀">
    <meta property="og:title" content="webpack | 🚀">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="🚀, back to home" data-v-675d8756 data-v-4a583abe><!----> 🚀</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/weekly/" data-v-b8818f8c>Weekly <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/java/class" data-v-b8818f8c>Java <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/javascript/webpack" data-v-b8818f8c>JavaScript <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/server/shell" data-v-b8818f8c>Server <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/misc/" data-v-b8818f8c>Misc <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/git/" data-v-b8818f8c>Git <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/algorithm/" data-v-b8818f8c>Algorithm <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/code/" data-v-b8818f8c>Code <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/weekly/" data-v-b8818f8c>Weekly <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/java/class" data-v-b8818f8c>Java <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/javascript/webpack" data-v-b8818f8c>JavaScript <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/server/shell" data-v-b8818f8c>Server <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/misc/" data-v-b8818f8c>Misc <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/git/" data-v-b8818f8c>Git <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/algorithm/" data-v-b8818f8c>Algorithm <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/code/" data-v-b8818f8c>Code <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/javascript/webpack">Webpack</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/javascript/vue">Vue</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/javascript/vitepress">Vitepress</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/javascript/vite">vite</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/javascript/chrome">chrome</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/javascript/execution-context">execution-context</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><p>基于 webpack4.x 整理</p><h3 id="getting-started" tabindex="-1">Getting Started <a class="header-anchor" href="#getting-started" aria-hidden="true">#</a></h3><p>无需配置，<code>webpack</code> 能直接处理 js/json，支持 ES module</p><div class="language-bash"><pre><code>webpack src/entry.js -o dits/bundle.js --mode<span class="token operator">=</span>development
</code></pre></div><p><code>webpack</code> 默认读取工作目录下的 <code>webpack.config.js</code> 文件</p><h2 id="config" tabindex="-1">Config <a class="header-anchor" href="#config" aria-hidden="true">#</a></h2><h3 id="mode" tabindex="-1">mode <a class="header-anchor" href="#mode" aria-hidden="true">#</a></h3><p>production 模式下会自动压缩 js 代码</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  <span class="token comment">// mode: &#39;production&#39;,</span>
  mode<span class="token operator">:</span> <span class="token string">&#39;develoment&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="entry" tabindex="-1">entry <a class="header-anchor" href="#entry" aria-hidden="true">#</a></h3><p>单文件入口，打包后只生成一个 chunk <code>main.js</code></p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&#39;src/index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// entry: [&#39;src/index.js&#39;, &#39;public/index.html&#39;],</span>
<span class="token punctuation">}</span>
</code></pre></div><p>多文件入口，打包后生成多个 chunk <code>page1.js</code> <code>page2.js</code> 可用于多页面打包</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    page1<span class="token operator">:</span> <span class="token string">&#39;src/page1/index.js&#39;</span><span class="token punctuation">,</span>
    page2<span class="token operator">:</span> <span class="token string">&#39;src/page2/index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="output" tabindex="-1">output <a class="header-anchor" href="#output" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 指定目录 + 名称 */</span>
    filename<span class="token operator">:</span> <span class="token string">&#39;js/[name].[contenthash:10].js&#39;</span><span class="token punctuation">,</span>

    <span class="token comment">/* 指定打包结果统一输出目录 */</span>
    path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/* 所有资源引入路径的前缀 */</span>
    publicPath<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span>，

    <span class="token comment">/**
     * 指定非入口 chunk 的命名规则
     * 如 import() 引入的资源，名字默认是 [数字].js
     */</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">&#39;[name]_[chunkhash].chun.js&#39;</span><span class="token punctuation">,</span>

    <span class="token comment">/* 向外暴露的变量名 */</span>
    library<span class="token operator">:</span> <span class="token string">&#39;myTool&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">/* 输出哪种模块规范 */</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">&#39;commonjs&#39;</span><span class="token punctuation">,</span> <span class="token comment">// amd | umd | global | window</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="loader" tabindex="-1">loader <a class="header-anchor" href="#loader" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 不参与解析的库 */</span>
    noParse<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(vue|vue-router|vuex|vuex-router-sync)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 配置形式一</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;less-loader&#39;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&#39;postcss-loader&#39;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        sideEffects<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 配置形式二</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpe?g|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          limit<span class="token operator">:</span> <span class="token number">4096</span><span class="token punctuation">,</span>
          outputPath<span class="token operator">:</span> <span class="token string">&#39;imgs&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">⚠️</p><p>写在后面的 loader 先执行，并将执行结果交由前一个 loader 处理</p></div><h3 id="plugins" tabindex="-1">plugins <a class="header-anchor" href="#plugins" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="optimization" tabindex="-1">optimization <a class="header-anchor" href="#optimization" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 生产环境开启压缩 */</span>
    minimize<span class="token operator">:</span> isEnvProduction<span class="token punctuation">,</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/**
       * 将 node_modules 的代码打包成一个单独的 chunk
       * 会自动分析多入口，并抽离公共的依赖
       */</span>
      chunks<span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">/* 当 chunk 大于 30k 才会被分割出来 */</span>
      minSize<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
      maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token comment">/* 依赖至少被引用 1次 */</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token comment">/* 按需加载时，并行加载文件的最大数量 */</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token comment">/* 入口 js 文件最大并行请求数 */</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token comment">/* 命名连接符号 */</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">&#39;~&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">/* 可以使用命名规则 */</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">/* 分割 chunk 的组，以上规则对分组有效 */</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">/* node_modules 目录下的包抽离到 vendors.js */</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        common<span class="token operator">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token comment">/* 复用已提取过的模块，以免重复打包 */</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 当 chunkA 依赖 chunkB 时，
     * 当 chunkA 内记录了 chunkB 的 hash
     * chunkB hash 变化导致 chunkA 内容变化...连锁反应
     * 将模块记录的 hash 单独打包成一个文件，变化缩小在这个文件内
     */</span>
    runtimeChunk<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">name</span><span class="token operator">:</span> <span class="token parameter">entryPoint</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">runtime~</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entryPoint<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 配置生产环境 js css 压缩方案
     * webpack 4.26.x 内部使用 terser-webpack-plugin 做代码压缩
     */</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">/* 压缩 js */</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 多进程</span>
        sourceMap<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/* 压缩 css */</span>
      <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        cssProcessorOptions<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        cssProcessorPluginOptions<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="devserver" tabindex="-1">devServer <a class="header-anchor" href="#devserver" aria-hidden="true">#</a></h3><p>执行 <code>npx webpack-dev-server</code>，编译打包结果保存在内存，不输出文件，watch 文件变化后自动编译</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  <span class="token comment">/* 打包输出目录 ???? */</span>
  conentBase<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// watchContentBase: true,</span>
  watchOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    ignored<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* 启用 gizp */</span>
  compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
  <span class="token comment">/* 在浏览器中打开 */</span>
  open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">/* HMR */</span>
  hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  host<span class="token operator">:</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
  proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 转发 /api/xxx 开头的请求到指定服务器 */</span>
    <span class="token string">&#39;/api&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">&#39;http://api.host.com:3000&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">/* 转发请求前，重写接口地址(去掉 /api 前缀) */</span>
      pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;^/api&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* 不要显示启动服务器日志信息 */</span>
  clientLogLevel<span class="token operator">:</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">/* 只显示基本信息 */</span>
  quiet<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">/* 出错了不要全屏提示 */</span>
  overlay<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>style-loader</code> <code>vue-loader</code> 内部实现了 <code>HMR</code>，但 js 默认没有实现，修改 js 文件会导致所以模块重新编译</p><p>示例：当 <code>math.js</code> 内容变化时，实现 <code>math.js</code> 热更新</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./math&#39;</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// 判断是否开启了 HMR</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">&#39;./math.js&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="peformance" tabindex="-1">peformance <a class="header-anchor" href="#peformance" aria-hidden="true">#</a></h3><p>关闭 webpack 自带的性能分析（提高速度），一般我们使用其他插件做性能分析</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  performance<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="devtool" tabindex="-1">devtool <a class="header-anchor" href="#devtool" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token punctuation">{</span>
  devtool<span class="token operator">:</span> <span class="token string">&#39;source-map&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th>取值</th><th>效果</th><th>source map 文件</th></tr></thead><tbody><tr><td>source-map</td><td>打印错误文件名和行数，能跳转到源代码出错位置</td><td>完整到 sourceMap 文件</td></tr><tr><td>inline-source-map</td><td>同上</td><td>把所有 sourceMap 内联到 js 尾部，优势：构建速度快</td></tr><tr><td>eval-source-map</td><td>文件名错误，其他同上</td><td>每个 sourceMap 分别内联到每个 eval 函数中</td></tr><tr><td>hidden-source-map</td><td>打印错误文件名，但行数错误，会跳转到构建后码出错位置</td><td></td></tr><tr><td>nosources-source-map</td><td>打印错误文件名和行数，无法跳转到代码出错位置</td><td>无 sourceMap 文件</td></tr><tr><td>cheap-source-map</td><td>打印错误文件名和行数，能跳转到源代码位置，不能精确定位到错误所在列</td><td></td></tr><tr><td>cheap-module-source-map</td><td>同上</td><td>会将 loader 的 source map 加进来</td></tr></tbody></table><p>速度 eval &gt; inline &gt; cheap</p><p>速度 <code>eval-cheap-source-map</code> &gt; <code>eval-source-map</code></p><p>调试友好 <code>source-map</code> &gt; <code>cheap-module-source-map</code> &gt; <code>cheap-source-map</code></p><h3 id="externals" tabindex="-1">externals <a class="header-anchor" href="#externals" aria-hidden="true">#</a></h3><p>指定外部库，不进行打包处理</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  externals<span class="token operator">:</span> <span class="token punctuation">{</span>
    jquery<span class="token operator">:</span> <span class="token string">&#39;jQuery&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="resolve" tabindex="-1">resolve <a class="header-anchor" href="#resolve" aria-hidden="true">#</a></h3><p>配置模块的解析规则</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 路径别名 */</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      @<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">/* 路径名可省略的文件类型后缀, 注：同名文件会隐患 */</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.json&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.vue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jsx&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">/* 除了 node_modules 外的其他目录中寻找依赖模块 */</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../my-modules&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="resolveloadrs" tabindex="-1">resolveLoadrs <a class="header-anchor" href="#resolveloadrs" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token punctuation">{</span>
  resolveLoadrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;my-loaders&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="node" tabindex="-1">node <a class="header-anchor" href="#node" aria-hidden="true">#</a></h2><p>webpack4 会把一些 node 模块打包进来，但是在浏览器端用不上</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  node<span class="token operator">:</span> <span class="token punctuation">{</span>
    module<span class="token operator">:</span> <span class="token string">&#39;empty&#39;</span><span class="token punctuation">,</span>
    dgram<span class="token operator">:</span> <span class="token string">&#39;empty&#39;</span><span class="token punctuation">,</span>
    dns<span class="token operator">:</span> <span class="token string">&#39;mock&#39;</span><span class="token punctuation">,</span>
    fs<span class="token operator">:</span> <span class="token string">&#39;empty&#39;</span><span class="token punctuation">,</span>
    http2<span class="token operator">:</span> <span class="token string">&#39;empty&#39;</span><span class="token punctuation">,</span>
    net<span class="token operator">:</span> <span class="token string">&#39;empty&#39;</span><span class="token punctuation">,</span>
    tls<span class="token operator">:</span> <span class="token string">&#39;empty&#39;</span><span class="token punctuation">,</span>
    child_process<span class="token operator">:</span> <span class="token string">&#39;empty&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="official-loader" tabindex="-1">Official Loader <a class="header-anchor" href="#official-loader" aria-hidden="true">#</a></h2><p>loader 本质上是一个函数</p><p>同步 loader 示例</p><div class="language-js"><pre><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> map<span class="token punctuation">,</span> meta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// process content...</span>

  <span class="token comment">// 直接返回处理结果或使用回调</span>
  <span class="token keyword">return</span> content <span class="token comment">// or this.call(err, content, map?, meta?)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 各个 loader 的 pitch 函数是按配置 loader 的顺序执行</span>
<span class="token comment">// 这和 use 中 loader 的执行顺序相反</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>异步 loader 示例（推荐）</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;loader-utils&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> validate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;schema-utils&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 参数类型</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 配置项及其值的类型</span>
    maxSize<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&#39;最大xxx值&#39;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  additionalProperties<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否允许存在额外的属性</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> map<span class="token punctuation">,</span> meta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取 loder 的 options 配置</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token comment">// 校验 options 配置是否正确</span>
  <span class="token function">validate</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;my loader&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> content<span class="token punctuation">,</span> map<span class="token operator">?</span><span class="token punctuation">,</span> meta<span class="token operator">?</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="style-loader" tabindex="-1">style-loader <a class="header-anchor" href="#style-loader" aria-hidden="true">#</a></h3><h3 id="css-loader" tabindex="-1">css-loader <a class="header-anchor" href="#css-loader" aria-hidden="true">#</a></h3><h3 id="postcss-loader" tabindex="-1">postcss-loader <a class="header-anchor" href="#postcss-loader" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">&#39;postcss-loader&#39;</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/* 固定写法 */</span>
      ident<span class="token operator">:</span> <span class="token string">&#39;postcss&#39;</span><span class="token punctuation">,</span>
      <span class="token function">plugins</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
          <span class="token comment">/**
           * 该插件用于解析(package.json) browserslist 的配置
           * 以构建兼容到指定浏览器的 css
           */</span>
          <span class="token function">required</span><span class="token punctuation">(</span><span class="token string">&#39;postcss-preset-env&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>package.json</code> 中的配置</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;browserslist&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;last 1 chrome version&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;last 1 firefox version&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;last 1 safari version&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;&gt;2%&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;not dead&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;not op_mini all&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">⚠️</p><p><code>postcss-preset-env</code> 依赖 <code>process.<wbr>env.NODE_ENV</code> 读取 <code>browserslist</code> 对应的配置，应确保该值正确设置</p></div><h3 id="less-loader" tabindex="-1">less-loader <a class="header-anchor" href="#less-loader" aria-hidden="true">#</a></h3><h3 id="url-loader" tabindex="-1">url-loader <a class="header-anchor" href="#url-loader" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(bmp|jpe?g|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  loader<span class="token operator">:</span> <span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 转 base64 的上限 */</span>
    limit<span class="token operator">:</span> <span class="token number">4096</span><span class="token punctuation">,</span>

    <span class="token comment">/* 使用 es module 解析 */</span>
    esModule<span class="token operator">:</span> <span class="token boolean">true</span>，

    name<span class="token operator">:</span> <span class="token string">&#39;[contenthash:10].[ext]&#39;</span><span class="token punctuation">,</span>

    fallback<span class="token operator">:</span> <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">&#39;option-loader&#39;</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&#39;media/[name][hash:8].[ext]&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="file-loader" tabindex="-1">file-loader <a class="header-anchor" href="#file-loader" aria-hidden="true">#</a></h3><p>和 <code>url-loader</code> 类似，但是不会转 <code>base64</code></p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  <span class="token comment">// test: /\.(woff)$/, 可以不指定</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(css|less|scss|js|json|jpe?g|png|gif|)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  loader<span class="token operator">:</span> <span class="token string">&#39;file-loader&#39;</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&#39;[contenthash:10].[ext]&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="eslint-loader" tabindex="-1">eslint-loader <a class="header-anchor" href="#eslint-loader" aria-hidden="true">#</a></h3><p>安装 <code>eslint</code> <code>eslint-plugin-import</code></p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  loader<span class="token operator">:</span> <span class="token string">&#39;eslint-loader&#39;</span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 提高性能</span>
  enforce<span class="token operator">:</span> <span class="token string">&#39;pre&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 必须优先执行，检查不通过就不走后面的 loader</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 自动修复错误 */</span>
    fix<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>安装 <code>eslint-config-airbnb-base</code> 并在 <code>package.json</code> 中配置</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  <span class="token string">&quot;eslintConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token string">&quot;airbnb-base&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;browser&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">💡</p><p>设置 <code>env.browser</code>，否则 eslint 会判定 <code>window</code> <code>document</code> <code>navigator</code> 是未声明变量</p></div><p>常用的行内规则</p><div class="language-js"><pre><code><span class="token comment">// eslint-disable-next-line</span>

<span class="token comment">/* global jQuery */</span>
</code></pre></div><h3 id="babel-loader" tabindex="-1">babel-loader <a class="header-anchor" href="#babel-loader" aria-hidden="true">#</a></h3><p>安装 <code>@babel/core</code> (核心) <code>@babel/preset-env</code>（规则集） <code>core-js</code>（兼容 API）</p><blockquote><p>As of Babel 7.4.0, <code>@babel/polyfill</code> has been deprecated in favor of directly including <code>core-js/stable</code> (to polyfill ECMAScript features) and `...</p></blockquote><div class="language-js"><pre><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  loader<span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 预设规则 */</span>
    presets<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span><span class="token string">&#39;@babel/preset-env&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token comment">/* 只引入使用到的 polyfill */</span>
        useBuiltIns<span class="token operator">:</span> <span class="token string">&#39;useage&#39;</span><span class="token punctuation">,</span>

        <span class="token comment">/* 指定当前安装的版本 */</span>
        corejs<span class="token operator">:</span> <span class="token punctuation">{</span> version<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

        targets<span class="token operator">:</span> <span class="token punctuation">{</span>
          chrome<span class="token operator">:</span> <span class="token string">&#39;60&#39;</span><span class="token punctuation">,</span>
          firefox<span class="token operator">:</span> <span class="token string">&#39;60&#39;</span><span class="token punctuation">,</span>
          safari<span class="token operator">:</span> <span class="token string">&#39;10&#39;</span><span class="token punctuation">,</span>
          ie<span class="token operator">:</span> <span class="token string">&#39;10&#39;</span><span class="token punctuation">,</span>
          edge<span class="token operator">:</span> <span class="token string">&#39;17&#39;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">/* 二次构建时，读取之前 的缓存 */</span>
    cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>babel-loader</code> 本身支持缓存，可以不使用 <code>cache-loader</code></p><h3 id="thread-loader" tabindex="-1">thread-loader <a class="header-anchor" href="#thread-loader" aria-hidden="true">#</a></h3><p>配合 <code>babel-loader</code> 开启多进程编译</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">&#39;thread-loader&#39;</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">/* 进程个数 */</span>
        workers<span class="token operator">:</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> loader<span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">⚠️</p><p>进程启动大概 600ms ，进程之间通信也要消耗时间，如果项目非常小，没有必要使用</p></div><h3 id="cache-loader" tabindex="-1">cache-loader <a class="header-anchor" href="#cache-loader" aria-hidden="true">#</a></h3><h2 id="official-plugin" tabindex="-1">Official Plugin <a class="header-anchor" href="#official-plugin" aria-hidden="true">#</a></h2><p>webpack 定义了很多编译过程中的钩子，这些钩子 Tapable 类的实现</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> RawSource <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack-sources&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> validate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;schema-utils&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> globby <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;globby&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    to<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&#39;起始目录&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">,</span>
    from<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&#39;目标目录&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">,</span>
    ignore<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;array&#39;</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&#39;忽略文件&#39;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  additionalProperties<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">validate</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;MyPlugin&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
  <span class="token punctuation">}</span>
  <span class="token function">apply</span> <span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>thisCompilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;MyPlugin&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>additionalAssets<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&#39;MyPlugin&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 手动添加文件</span>
        compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span><span class="token string">&#39;a.txt&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&#39;hello&#39;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 使用 webpack-sources 转化文件</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;b.text&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
        compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span><span class="token string">&#39;b.text&#39;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RawSource</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">// 复制指定目录的文件</span>
        <span class="token keyword">const</span> baseDir <span class="token operator">=</span> compiler<span class="token punctuation">.</span>options<span class="token punctuation">.</span>context
        <span class="token keyword">const</span> toDir <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>to <span class="token operator">||</span> <span class="token string">&#39;.&#39;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> from<span class="token punctuation">,</span> ignore <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options
        <span class="token keyword">const</span> fromDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">?</span> from <span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>from<span class="token punctuation">)</span>
        <span class="token keyword">const</span> paths <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">globby</span><span class="token punctuation">(</span>fromDir<span class="token punctuation">,</span> <span class="token punctuation">{</span> ignore <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 获取要复制的文件的路径</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> filePath <span class="token keyword">of</span> paths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> relativePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
          <span class="token keyword">const</span> filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> relativePath<span class="token punctuation">)</span>
          compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RawRouce</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPlugin
</code></pre></div><p>测试 MyPlugin</p><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  from<span class="token operator">:</span> <span class="token string">&#39;public&#39;</span><span class="token punctuation">,</span>
  to<span class="token operator">:</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">,</span>
  ignore<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;**/index.html&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="html-webpack-plugin" tabindex="-1">html-webpack-plugin <a class="header-anchor" href="#html-webpack-plugin" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">/* 指定 html 模版，不指定会自动生成 index.html */</span>
  template<span class="token operator">:</span> <span class="token string">&#39;public/index.html&#39;</span><span class="token punctuation">,</span>

  <span class="token comment">/* 压缩 */</span>
  minify<span class="token operator">:</span> <span class="token punctuation">{</span>
    collapseWhiteSpace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="inline-chunk-html-plugin" tabindex="-1">inline-chunk-html-plugin <a class="header-anchor" href="#inline-chunk-html-plugin" aria-hidden="true">#</a></h3><p>将 js 内联到 index.html 中</p><div class="language-js"><pre><code>isEnvProduction <span class="token operator">&amp;&amp;</span> <span class="token keyword">new</span> <span class="token class-name">InlineChunkHtmlPlugin</span><span class="token punctuation">(</span>HtmlWebpackPlugin<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">runtime.+\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mini-css-extract-plugin" tabindex="-1">mini-css-extract-plugin <a class="header-anchor" href="#mini-css-extract-plugin" aria-hidden="true">#</a></h3><p>配合其内置的 loader ，可以提取 css 为外置连接引入</p><div class="language-js"><pre><code><span class="token comment">// 设置 css loader</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&#39;css-loader&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 添加 plugin</span>
<span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  filename<span class="token operator">:</span> <span class="token string">&#39;css/app.css&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="intervolga-optimize-cssnano-plugin" tabindex="-1">@intervolga/optimize-cssnano-plugin <a class="header-anchor" href="#intervolga-optimize-cssnano-plugin" aria-hidden="true">#</a></h3><h3 id="optimize-css-assets-webpack-plugin" tabindex="-1">optimize-css-assets-webpack-plugin <a class="header-anchor" href="#optimize-css-assets-webpack-plugin" aria-hidden="true">#</a></h3><p>用于压缩 css 文件</p><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">💡</p><p>行文中的 <code>resolve</code> 函数是 <code>path.resolve</code></p></div><h3 id="workbox-webpack-plugin" tabindex="-1">workbox-webpack-plugin <a class="header-anchor" href="#workbox-webpack-plugin" aria-hidden="true">#</a></h3><p>使用 serviceWorker 构建 PWA 渐进式网络开发应用程序，使用该插件生成 <code>service-worker.js</code> 配置文件</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">WorkboxWebpackPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">/**
       * 帮助 serviceWorker 快速启动
       * 删除旧的 serviceWorker
       */</span>
      clientsClaim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      skipWaiting<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 main.js 注册 serviceWorker</p><div class="language-js"><pre><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;serviceWorker&#39;</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&#39;/service-worker&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="webpack-dllplugin" tabindex="-1">webpack.DllPlugin <a class="header-anchor" href="#webpack-dllplugin" aria-hidden="true">#</a></h3><p>对某些（第三方）库<em>预先</em>进行单独打包好，开发过程中之间引入打包结果，跳过该部分文件的打包，以提高构建速度</p><div class="language-js"><pre><code><span class="token comment">// webpack.dll.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webapck <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    dll<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jQuery&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;vendor&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">&#39;[name]_[hash]&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">/* 生成 manifest.json 提供生成 dll 的映射关系 */</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">/* 同 output.library 配置 */</span>
      name<span class="token operator">:</span> <span class="token string">&#39;[name]_[hash]&#39;</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;vendor/manifest.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行 <code>npx webpack --config webpack.dll.js</code> 打包生成 <code>dll.js</code> 和 <code>manifest.json</code></p><p>修改 <code>webpack.config.js</code> 配置，应用打包结果</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">/* webpack 根据 manifest 忽略已打包到 dll.js 中的文件 */</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      manifest<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;vendor/manifest.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/* 将预先打包好的 dll.js 插入到 inex.html 中  */</span>
    <span class="token keyword">new</span> <span class="token class-name">require</span><span class="token punctuation">(</span><span class="token string">&#39;add-assets-html-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filepath<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;vendor/dll.js&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="webpack-defineplugin" tabindex="-1">webpack.DefinePlugin <a class="header-anchor" href="#webpack-defineplugin" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">PUBLIC_URL</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="webpack-hotmodulereplacementplugin" tabindex="-1">webpack.HotModuleReplacementPlugin <a class="header-anchor" href="#webpack-hotmodulereplacementplugin" aria-hidden="true">#</a></h3><div class="language-js"><pre><code>isEnvProduction <span class="token operator">&amp;&amp;</span> <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="webpack-ignoreplugin" tabindex="-1">webpack.IgnorePlugin <a class="header-anchor" href="#webpack-ignoreplugin" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token comment">// https://github.com/jmblog/how-to-optimize-momentjs-with-webpack</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/locale$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token comment">// or</span>
<span class="token keyword">new</span> <span class="token class-name">wepback<span class="token punctuation">.</span>ContextReplacementPlugin</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment[/\\]locale$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">zh-ch</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
</code></pre></div><h3 id="manifest-plugin" tabindex="-1">manifest-plugin <a class="header-anchor" href="#manifest-plugin" aria-hidden="true">#</a></h3><h2 id="hash" tabindex="-1">Hash <a class="header-anchor" href="#hash" aria-hidden="true">#</a></h2><table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>hash</td><td>每次构建都会变化（除非你不想缓存静态资源）</td></tr><tr><td>chunkhash</td><td>根据 chunk 生成，当 main.js 引入 css 时，css 内容变化，也会导致生成的 js 文件 hash 变化，且 hash 一样</td></tr><tr><td>contenthash</td><td>根据文件内容生产 hash（可靠）</td></tr></tbody></table><h2 id="tree-shaking" tabindex="-1">Tree Shaking <a class="header-anchor" href="#tree-shaking" aria-hidden="true">#</a></h2><p>前提：1. 使用 ES module 2. mode 设置为 production</p><p><code>import &quot;./style/index.less&quot;</code> 被 shaking 掉了？！要正确配置项目 <code>package.json</code> 中的 <code>sideEffects</code> 字段，</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.less&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="code-split" tabindex="-1">Code Split <a class="header-anchor" href="#code-split" aria-hidden="true">#</a></h2><p>使用 <code>import()</code> 语法，webpack 会自动将模块单独打包，可以实现运行时加载(lazy load) 和 浏览器空闲时加载(prefetch)</p><div class="language-js"><pre><code><span class="token comment">/* 如果不指定 `webpackChunkName` 文件名是数字递增，不友好 */</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;math&quot;, webpackPrefetch: true */</span><span class="token punctuation">,</span> <span class="token string">&#39;./math&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> add <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">⚠️</p><p>预加载需要浏览器支持，注意兼容性问题</p></div><h2 id="optimize" tabindex="-1">Optimize <a class="header-anchor" href="#optimize" aria-hidden="true">#</a></h2><ul><li><p>打包速度</p><ol><li>loader 使用 oneOf ，命中一个 loader 就不走其他 loader 了 使用 <code>exclude</code> 排除 <code>node_modules</code> 之类的目录</li></ol><div class="language-js"><pre><code><span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">/* 有两种 loader 处理了 js文件，这里要提到 oneOf 外面，否则有一个不生效  */</span>
    <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token string">&#39;eslint-loader&#39;</span><span class="token punctuation">,</span> enforce<span class="token operator">:</span> <span class="token string">&#39;pre&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>使用 <code>thread-loader</code> 开启多进程打包</li><li>使用 <code>webpack.DllPlugin</code> 预先打包好一些第三方库（这些依赖不会轻易更新），再打包时跳过这些库</li><li>配置 <code>externals</code> 某些文件走 CDN，直接跳过打包</li><li>配置 <code>devServer.watchOptions.ignored</code> 忽略某些目录(node_modules)</li><li>配置 <code>cache-loader</code> 缓存编译结果</li><li>contenthas 是否比 has 更慢？</li></ol></li></ul><h3 id="development" tabindex="-1">development <a class="header-anchor" href="#development" aria-hidden="true">#</a></h3><ul><li><p>HMR</p><ol><li>devServer 开启 Hot Module Replace</li></ol></li><li><p>调试体验</p><ol><li>兼顾编译速度和调试友好，devtool 选择 <code>eval-source-map</code>（调试更好）或 <code>eval-cheap-module-source-map</code>（速度更快）</li></ol></li><li><p>缓存</p><ol><li><code>babel-loader</code> options 设置 <code>cacheDirectory: true</code></li></ol></li></ul><h3 id="production" tabindex="-1">production <a class="header-anchor" href="#production" aria-hidden="true">#</a></h3><ul><li><p>运行时性能</p></li><li><p>隐藏源码</p><ol><li>devtool 设置为 <code>nosources-source-map</code> 或 false 。切忌使用 inline- ，这会使代码体积变得很大！</li><li>混淆</li></ol></li><li><p>加载速度</p><ol><li>使用 ES module 以实现 tree shaking</li><li>静态资源预先 gzip（服务器需开启对应配置）</li><li>配置 <code>optimization: { splitChunks }</code> 抽离公共依赖为单独 chunk 降低代码变动缓存失效</li><li>使用 <code>import()</code> 实现懒加载、预加载</li><li>配置 externals ，配置 CDN</li></ol></li><li><p>缓存</p><ol><li>避免缓存失效：文件名不使用 <code>hash</code> <code>chunkhash</code>，启用 <code>runtimeChunk</code></li><li>避免缓存不失效：静态资源输出文件名使用 <code>contenthash</code> 后缀，文件改动部署后，浏览器请求最新构建结果</li></ol></li></ul></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"algorithm_book-grokking-algorithms.md\":\"ed0c201e\",\"algorithm_book-js-data-structure-and-algorithms.md\":\"7438b73d\",\"algorithm_index.md\":\"eb86cecb\",\"algorithm_practice.md\":\"582bc387\",\"book_professional_javascript_for_web_developers_chapter_1.md\":\"8bb266a7\",\"book_professional_javascript_for_web_developers_chapter_2.md\":\"d863f3bf\",\"code_package-tapable.md\":\"1464f658\",\"css_compatible.md\":\"5a94e63c\",\"css_css-next.md\":\"ce17cd0a\",\"css_css2.md\":\"2291368b\",\"git_github.md\":\"7f69e671\",\"git_gitlab.md\":\"7fb2fad6\",\"index.md\":\"07b3b3e7\",\"java_annotation.md\":\"47f8d6bd\",\"java_class.md\":\"ff2ceb05\",\"java_collection-map.md\":\"84e0aaa9\",\"java_enum.md\":\"63e8fcdc\",\"java_generic.md\":\"6da30cfc\",\"java_index.md\":\"528687f9\",\"java_interface.md\":\"abdbd003\",\"java_io.md\":\"76730534\",\"java_summary.md\":\"b5b43040\",\"java_thread.md\":\"30ae6546\",\"java_util-date-time.md\":\"0b730e29\",\"java_util_compare.md\":\"6ca3be47\",\"javascript_book-javascript-pattern-design.md\":\"9b007344\",\"javascript_execution-context.md\":\"a7634d04\",\"javascript_npm.md\":\"4f4cb3cf\",\"javascript_performance-vue.md\":\"e79f3d0e\",\"javascript_vue.md\":\"364d3a5a\",\"javascript_web-performance.md\":\"ca73405b\",\"javascript_webpack-5.md\":\"63d49dba\",\"javascript_webpack.md\":\"7905c607\",\"misc_fe-team.md\":\"13e69cc7\",\"misc_index.md\":\"187d5c99\",\"misc_start-yml.md\":\"83420d2d\",\"misc_words.md\":\"74372279\",\"protocol_book-grokking-http.md\":\"65bbbe0d\",\"server_my-sql.md\":\"32dba277\",\"server_nodejs.md\":\"5b753fae\",\"server_shell.md\":\"949e7286\",\"special_micro-fe.md\":\"efca0e2d\",\"typescript_index.md\":\"29a8d5e3\",\"typescript_types.md\":\"0f70074a\",\"weekly_2021-10-31.md\":\"0eb9d4f7\",\"weekly_2021-11-07.md\":\"c51de258\",\"weekly_index.md\":\"0c42695a\"}")</script>
    <script type="module" async src="/assets/app.8a965c85.js"></script>
    
  </body>
</html>