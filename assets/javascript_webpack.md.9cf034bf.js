import{o as n,c as s,d as a}from"./app.d7e7aadc.js";const e='{"title":"webpack5","description":"","frontmatter":{"title":"webpack5"},"headers":[{"level":3,"title":"持久缓存","slug":"持久缓存"},{"level":3,"title":"内置 loader","slug":"内置-loader"},{"level":3,"title":"支持 URIs","slug":"支持-uris"},{"level":3,"title":"chunkId","slug":"chunkid"},{"level":3,"title":"不自动 polyfill nodejs 包","slug":"不自动-polyfill-nodejs-包"},{"level":3,"title":"tree shaking 增强","slug":"tree-shaking-增强"},{"level":3,"title":"sideEffects","slug":"sideeffects"},{"level":3,"title":"module federation","slug":"module-federation"},{"level":3,"title":"Top await","slug":"top-await"}],"relativePath":"javascript/webpack.md","lastUpdated":1620227023151}',t={},p=a('<p>三大变化</p><ol><li>持久缓存</li><li>tree shaking 增强</li><li>module federation</li></ol><h3 id="持久缓存"><a class="header-anchor" href="#持久缓存" aria-hidden="true">#</a> 持久缓存</h3><div class="language-js webpack.config.js"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  mode<span class="token operator">:</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>\n  devtool<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  entry<span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>\n  watch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  cache<span class="token operator">:</span> <span class="token punctuation">{</span>\n    type<span class="token operator">:</span> <span class="token string">&#39;memory&#39;</span><span class="token punctuation">,</span> <span class="token comment">// memory|filesystem</span>\n    cacheDirectory<span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;node_modules/.cahce/webpack&#39;</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>\n    port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>cache type 设置为 filesystem 和 cnpm 不兼容</p></div><h3 id="内置-loader"><a class="header-anchor" href="#内置-loader" aria-hidden="true">#</a> 内置 loader</h3><p>raw-loader file-loader url-loader</p><div class="language-js"><pre><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>\n  rules<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.png$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>\n      type<span class="token operator">:</span> <span class="token string">&#39;asset/resoucre&#39;</span><span class="token punctuation">,</span> <span class="token comment">// file-loader</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.text$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>\n      type<span class="token operator">:</span> <span class="token string">&#39;asset/soucre&#39;</span><span class="token punctuation">,</span> <span class="token comment">// raw-loader</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.ico$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>\n      type<span class="token operator">:</span> <span class="token string">&#39;asset/inline&#39;</span><span class="token punctuation">,</span> <span class="token comment">// url-loader 小于指定值，默认 base64</span>\n\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n\n</code></pre></div><h3 id="支持-uris"><a class="header-anchor" href="#支持-uris" aria-hidden="true">#</a> 支持 URIs</h3><div class="language-js"><pre><code><span class="token keyword">import</span> title <span class="token keyword">from</span> <span class="token string">&#39;data:text/javascript,export default &quot;title&quot;&#39;</span>\n</code></pre></div><h3 id="chunkid"><a class="header-anchor" href="#chunkid" aria-hidden="true">#</a> chunkId</h3><p>webpack4 默认是自然数递增（natural），不合理</p><div class="language-js"><pre><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>\n  main<span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\noptimization<span class="token operator">:</span> <span class="token punctuation">{</span>\n  chunkIds<span class="token operator">:</span> <span class="token string">&#39;deterministic&#39;</span><span class="token punctuation">,</span> <span class="token comment">// natural|named|deterministic</span>\n  moduleIds<span class="token operator">:</span> <span class="token string">&#39;deterministic&#39;</span><span class="token punctuation">,</span> <span class="token comment">// natural|named|deterministic</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\noutput<span class="token operator">:</span> <span class="token punctuation">{</span>\n  filename<span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 入口文件打包名</span>\n  chunkFilename<span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 非入口文件，如异步加载文件打包名</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre></div><h3 id="不自动-polyfill-nodejs-包"><a class="header-anchor" href="#不自动-polyfill-nodejs-包" aria-hidden="true">#</a> 不自动 polyfill nodejs 包</h3><div class="language-js"><pre><code>resolve<span class="token operator">:</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 向下兼容</span>\n  fallback<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token string">&#39;stream&#39;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;stream&#39;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;buffer&#39;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// 或者</span>\n  <span class="token comment">// fallback: {</span>\n  <span class="token comment">//   &#39;crypto&#39;: require.resolve(&#39;crypto-browserify&#39;),</span>\n  <span class="token comment">//   &#39;stream&#39;: require.resolve(&#39;stream-browserify&#39;),</span>\n  <span class="token comment">//   &#39;buffer&#39;: require.resolve(&#39;buffer&#39;),</span>\n  <span class="token comment">// }</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h3 id="tree-shaking-增强"><a class="header-anchor" href="#tree-shaking-增强" aria-hidden="true">#</a> tree shaking 增强</h3><div class="language-js"><pre><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>\n  usedExports<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h3 id="sideeffects"><a class="header-anchor" href="#sideeffects" aria-hidden="true">#</a> sideEffects</h3><div class="language-json package.json"><pre><code><span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n\n</code></pre></div><h3 id="module-federation"><a class="header-anchor" href="#module-federation" aria-hidden="true">#</a> module federation</h3><div class="language-js"><pre><code><span class="token comment">// remote webpack.config.js</span>\nplugins<span class="token operator">:</span> <span class="token punctuation">[</span>\n  <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    name<span class="token operator">:</span> <span class="token string">&#39;remoteVar&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 暴露的全局变量名</span>\n    filename<span class="token operator">:</span> <span class="token string">&#39;remoteEntry.js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 打包的入口文件</span>\n    exposes<span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token string">&#39;./NewsList.vue&#39;</span><span class="token operator">:</span> <span class="token string">&#39;./scr/components/NewsList.vue&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 暴露的共享组件</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 共享的库</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\n<span class="token comment">// host webpack.config.js</span>\nplugins<span class="token operator">:</span> <span class="token punctuation">[</span>\n  <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    name<span class="token operator">:</span> <span class="token string">&#39;host&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 暴露的全局变量名</span>\n    filename<span class="token operator">:</span> <span class="token string">&#39;hostEntry.js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 打包的入口文件</span>\n    remotes<span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token string">&#39;remote&#39;</span><span class="token operator">:</span> <span class="token string">&#39;remoteVar@http://localhost:8080/remoteEntry.js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 暴露的共享组件</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 共享的库</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\n</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>shard 是多版本共存，内部做版本检查，默认在所有版本中选择最高版本</p></div><h3 id="top-await"><a class="header-anchor" href="#top-await" aria-hidden="true">#</a> Top await</h3><div class="language-js"><pre><code><span class="token keyword">const</span> NewsList <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;remote/NewsList.vue&#39;</span><span class="token punctuation">)</span>\n</code></pre></div>',24);t.render=function(a,e,t,o,c,l){return n(),s("div",null,[p])};export default t;export{e as __pageData};
